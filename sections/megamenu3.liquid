{%- liquid
  assign fixed_aspect_ratio = false
  unless section.settings.image_size == 'natural'
    assign fixed_aspect_ratio = true
  endunless

  assign show_section = true

-%}

{%- if show_section -%}
  {%- if section.blocks.size > 0 -%}
    {%- liquid
      assign grid_item_width = 'medium-up--one-half'
      assign container_width = '600px'
      if section.blocks.size == 3
        assign grid_item_width = 'medium-up--one-third'
        assign container_width = '900px'
      endif
      if section.blocks.size == 4
        assign grid_item_width = 'medium-up--one-quarter'
        assign container_width = '1200px'
      endif
      if section.blocks.size == 5
        assign grid_item_width = 'medium-up--one-fifth'
        assign container_width = '1500px'
      endif
    -%}
<div class="megamenu-3">
    <div class="site-nav__dropdown megamenu text-left">
      <div class="page-width"{%- if container_width -%}style="max-width:{{container_width}}"{%- endif -%}>
	      <div class="grid grid--flush-bottom">
	        {%- for block in section.blocks -%}
	          <div class="grid__item {{ grid_item_width }}" {{ block.shopify_attributes }}>
	            {%- if block.settings.enable_image -%}
	              <a href="{{ block.settings.button_link }}" class="article__grid-image" aria-label="{{ block.settings.title }}">
	                {%- if block.settings.image != blank -%}
	                  {%- if fixed_aspect_ratio -%}
	                    <div class="image-wrap">
	                      <div
	                        class="grid__image-ratio grid__image-ratio--cover grid__image-ratio--{{ section.settings.image_size }} lazyload"
	                        data-bgset="{% render 'bgset', image: block.settings.image %}"
	                        data-sizes="auto">
	                      </div>
	                      <noscript>
	                        <img class="lazyloaded" src="{{ block.settings.image | img_url: '400x' }}" alt="{{ block.settings.title | escape }}">
	                      </noscript>
	                    </div>
	                  {%- else -%}
	                    <div class="image-wrap" style="height: 0; padding-bottom: {{ 100 | divided_by: block.settings.image.aspect_ratio }}%;">
	                      {%- assign img_url = block.settings.image | img_url: '1x1' | replace: '_1x1.', '_{width}x.' -%}
	                      <img class="lazyload"
	                          data-src="{{ img_url }}"
	                          data-widths="[180, 360, 540, 720, 900, 1080]"
	                          data-aspectratio="{{ block.settings.image.aspect_ratio }}"
	                          data-sizes="auto"
	                          alt="{{ block.settings.image.alt | escape }}">
	                      <noscript>
	                        <img class="lazyloaded" src="{{ block.settings.image | img_url: '400x' }}" alt="{{ block.settings.title | escape }}">
	                      </noscript>
	                    </div>
	                  {%- endif -%}
	                {%- else -%}
	                  {%- if fixed_aspect_ratio -%}
	                    <div class="image-wrap">
	                      <div
	                        class="grid__image-ratio grid__image-ratio--cover grid__image-ratio--{{ section.settings.image_size }} lazyloaded">
	                        {{ 'lifestyle-1' | placeholder_svg_tag: 'placeholder-svg' }}
	                      </div>
	                    </div>
	                  {%- else -%}
	                    {{ 'lifestyle-1' | placeholder_svg_tag: 'placeholder-svg' }}
	                  {%- endif -%}
	                {%- endif -%}
	              </a>
	            {%- endif -%}
	            {%- if block.settings.title != blank -%}
	              <div class="h4">{%- if block.settings.button_link -%}<a href="{{ block.settings.button_link }}">{%- endif -%}{{ block.settings.title }}{%- if block.settings.button_link -%}</a>{%- endif -%}</div>
	            {%- endif -%}
	            {%- if block.settings.text != blank -%}
	              <div class="rte-setting text-spacing">{{ block.settings.text }}</div>
	            {%- endif -%}
	            {%- if block.settings.button_label != blank -%}
	              <a href="{{ block.settings.button_link }}" class="btn--megamenu">
	                {{ block.settings.button_label }}
	              </a>
	            {%- endif -%}
				{%- if block.settings.mega_menu_link_list != blank -%}
	            {%- assign mega_menu = linklists[block.settings.mega_menu_link_list] -%}
	              <ul class="no-bullets site-nav__megamenu-list">
				  {%- for link in mega_menu.links -%}
				    <li>
				      <a href="{{ link.url }}" class="site-nav__dropdown-link">
				        {{ link.title }}
				      </a>
				    </li>
				  {%- endfor -%}
				  </ul>
	            {%- endif -%}
	          </div>
	        {%- endfor -%}
	      </div>
	    </div>
	</div>
  </div>
  {%- endif -%}
{%- endif -%}

{% schema %}
  {
    "name": "Megamenu 3",
    "max_blocks": 5,
    "class": "index-section--megamenu",
    "settings": [
      {
        "type": "select",
        "id": "image_size",
        "label": "Image size",
        "default": "wide",
        "options": [
          {
            "value": "natural",
            "label": "Natural"
          },
          {
            "value": "square",
            "label": "Square (1:1)"
          },
          {
            "value": "landscape",
            "label": "Landscape (4:3)"
          },
          {
            "value": "portrait",
            "label": "Portrait (2:3)"
          },
          {
            "value": "wide",
            "label": "Wide (16:9)"
          }
        ]
      }
    ],
    "blocks": [
      {
        "type": "promotion",
        "name": "Column",
        "settings": [
          {
            "type": "checkbox",
            "id": "enable_image",
            "label": "Show image",
            "default": true
          },
          {
            "type": "image_picker",
            "id": "image",
            "label": "Image"
          },
          {
            "type": "text",
            "id": "title",
            "label": "Heading",
            "default": "Menu promotion"
          },
          {
            "type": "richtext",
            "id": "text",
            "label": "Text",
            "default": "<p>Use this section to promote an item in the mega menu.</p>"
          },
          {
            "type": "text",
            "id": "button_label",
            "label": "Button label",
            "default": "Optional button"
          },
          {
            "type": "url",
            "id": "button_link",
            "label": "Link"
          }
        ]
      },
      {
        "type": "navigation",
        "name": "Navigation",
        "settings": [
          {
            "type": "checkbox",
            "id": "enable_image",
            "label": "Show image",
            "default": true
          },
          {
            "type": "image_picker",
            "id": "image",
            "label": "Image"
          },
          {
            "type": "url",
            "id": "button_link",
            "label": "Image Link"
          },
          {
            "type": "text",
            "id": "title",
            "label": "Heading",
            "default": "Navigation heading"
          },
          {
	        "type": "link_list",
	        "id": "mega_menu_link_list",
	        "label": "Navigation"
          }
        ]
      }
    ],
    "default": {
      "blocks": [
        {
          "type": "promotion"
        },
        {
          "type": "promotion"
        },
        {
          "type": "promotion"
        }
      ]
    }
  }
{% endschema %}
